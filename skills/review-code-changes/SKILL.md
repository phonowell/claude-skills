---
name: review-code-changes
description: 反复复盘代码修改验证真实性/正确性/优雅性/最小化原则，use when code modifications need quality review
allowed-tools: Read, Grep, Glob, Bash, Edit
---

# 代码修改复盘验证

## 何时使用
agent 修改代码后需要质量验证 · 确保真实性/正确性/优雅性/最小化

**核心意图**：通过多轮复盘发现并修复问题，避免低质量代码进入代码库  
**效率优先**：Read/Grep/Bash > Task · 并行≤3 · 只审最近变更  
**核心约束**：仅审用户指定范围或最近 diff · 每个问题需指向具体代码 · 不引入新需求/过度重构 · 未通过不得中断，必须修复后继续复盘（仅阻塞可中断并说明）

## 输入/输出契约
输入：`git diff`/范围、关键规范来源（CLAUDE.md/ESLint）、可用测试命令  
输出：问题清单（维度+位置+建议）+ 测试结果 + 通过/中断结论（仅阻塞可中断）

## 验证维度
**真实性**：解决实际问题，<3 次重复不抽象，不做无依据配置化  
**正确性**：类型/边界/依赖正确，少用断言，必要时跑相关测试  
**优雅性**：命名/结构遵循规范，声明与消费相邻  
**最小化**：简化=删除+合并+内联，减少不必要包装  
涉及安全/并发/语言特性时追加专项检查清单

## 工作流程
1. 确认范围：触发明确默认跳过需求确认，仅确认 `git diff` 或用户范围  
2. 真实性审查：若不匹配需求 → 指出问题、给出简化建议  
3. 正确性审查：修复类型/逻辑/依赖，必要时跑相关测试  
4. 优雅性审查：重构命名/结构，强调声明与消费靠近  
5. 最小化审查：删除/合并/内联，避免配置化膨胀  
6. 循环验证：重复 2-5 直到通过；任一项 ✗ 必须修复并回到 2，禁止等待用户要求  
7. 末轮测试：至少 `lint & type-check & test`，不可执行需说明原因与影响  
8. 每轮输出：`→ 第{N}轮 ✓真实性 ✓正确性 ✗优雅性:{问题} ✗最小化:{问题}`  
9. 返回结果：`✓ 代码复盘完成，满足所有质量要求` 或 `✗ 复盘中断：{原因}`

## 验证清单
- [ ] 范围明确且仅审最近变更
- [ ] 真实性/正确性/优雅性/最小化逐项复盘
- [ ] 每个问题有位置与建议
- [ ] 未通过时已修复并继续复盘，未等待用户要求
- [ ] 最终一轮执行 `lint & type-check & test`
- [ ] 返回信息按格式输出

## 示例
为 Button 添加 loading 状态：第1轮 ✗正确性(缺类型) → 修复 + 相关测试；第2轮 ✗最小化(未用 state) → 删除；第3轮 ✓全部 → `✓ 代码复盘完成，满足所有质量要求`
