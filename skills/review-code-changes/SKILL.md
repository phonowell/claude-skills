---
name: review-code-changes
description: 反复复盘代码修改验证真实性/正确性/优雅性/最小化原则，use when code modifications need quality review
allowed-tools: Read, Grep, Glob, Bash, Edit
---

# 代码修改复盘验证

## 何时使用

agent 修改代码后需要质量验证 · 确保满足真实/正确/优雅/最小化原则

**核心意图**：通过多轮复盘发现并修复代码问题，避免低质量代码进入代码库

**效率优先**

Read/Grep/Bash > Task · 并行≤3 · `pnpm exec tsc` 验证类型 · `pnpm lint` 验证规范

## 验证维度

**真实性**：解决实际问题，避免过度抽象 · **正确性**：逻辑无误，类型安全 · **优雅性**：符合项目规范，代码清晰 · **最小化**：只改必要部分，无冗余

## 工作流程

**跳过确认需求**：触发时机明确（代码修改后），直接执行

### 1. 识别修改范围

使用 `git diff` 或用户指定范围确定修改的文件和代码块

### 2. 真实性审查

解决实际问题（非假想需求）· 避免过度抽象（<3次重复不提取）· 避免不必要配置化

**✗** 指出问题 · 建议简化 · 重新修改

### 3. 正确性审查

`pnpm exec tsc` 检查类型 · 逻辑完整性（边界/空值）· 依赖正确性（导入路径/扩展名）

**✗** 执行修复 · 重新验证

### 4. 优雅性审查

遵循项目规范（CLAUDE.md/ESLint）· 命名清晰（避免缩写/单字母）· 结构合理（组件拆分/函数职责单一）

**✗** 重构代码 · 重新验证

### 5. 最小化审查

检查未使用代码（变量/导入/函数）· 重复逻辑可合并 · 不必要依赖

**✗** 清理冗余 · 重新验证

### 6. 循环验证

**多轮复盘**：重复步骤 2-5 直到所有维度通过 · **每轮必须执行 `pnpm lint` + `pnpm test`**

每轮输出：`→ 第{N}轮 ✓真实性 ✓正确性 ✗优雅性:{问题} ✗最小化:{问题}`

### 7. 返回结果

通过：`✓ 代码复盘完成，满足所有质量要求` · 中断：`✗ 复盘中断：{原因}`

## 示例

为 Button 添加 loading 状态

- 第1轮：✓真实性 ✗正确性:缺 `loading?: boolean` → 修复类型
- 第2轮：✓真实性 ✓正确性 ✗优雅性:未用 `clsx` → 重构 className
- 第3轮：✓真实性 ✓正确性 ✓优雅性 ✗最小化:未使用 `useState` → 移除
- 第4轮：✓所有维度 → `✓ 代码复盘完成，满足所有质量要求`
