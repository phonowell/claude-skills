---
name: review-code-changes
description: 反复复盘代码修改验证真实性/正确性/优雅性/最小化原则，use when code modifications need quality review
allowed-tools: Read, Grep, Glob, Bash, Edit
---

# 代码修改复盘验证

## 何时使用
- agent 改完代码后做质量复盘
- 目标：真实性/正确性/优雅性/最小化全通过

## 核心意图

通过多轮复盘发现并修复问题，避免低质量改动进入代码库。

## 效率优先

Read/Grep/Bash > Task · 并行≤3 · 默认仅审最近变更

## 核心约束

1. 范围：仅审用户指定范围或最近 diff
2. 定位：每个问题必须给出文件位置与修复建议
3. 边界：不引入新需求，不做过度重构
4. 闭环：任一项未通过必须先修复再继续复盘
5. 中断：仅阻塞问题可中断，并明确原因与影响
6. 附件一致性：若存在 `example.md`/`reference.md`，需与四维复盘标准和返回格式一致

## 输入/输出契约

- 输入：`git diff` 或指定范围、规范来源（CLAUDE.md/ESLint）、可用测试命令
- 输出：问题清单（维度+位置+建议）+ 测试结果 + 结论
- 成功：`✓ 代码复盘完成，满足所有质量要求`
- 失败：`✗ 复盘中断：{原因}`

## 验证维度

- 真实性：解决实际问题，<3 次重复不抽象，不做无依据配置化
- 正确性：类型/边界/依赖正确，少用断言，必要时跑相关测试
- 优雅性：命名/结构遵循规范，声明与消费相邻
- 最小化：删除+合并+内联，减少不必要包装
- 特殊域：安全/并发/语言特性变更时追加专项清单

## 工作流程

1. 确认范围：锁定 `git diff` 或用户指定范围
2. 真实性审查：不匹配需求则记录问题并给最小修复建议
3. 正确性审查：修复类型/逻辑/依赖问题，按需执行相关测试
4. 优雅性审查：修正命名/结构，保证声明与消费靠近
5. 最小化审查：删除冗余包装，合并重复逻辑
6. 循环复盘：重复 2-5；任一项 ✗ 必须修复后回到 2
7. 末轮验证：执行 `lint`/`type-check`/`test`（不可执行时说明原因与影响）
8. 每轮输出：`→ 第{N}轮 ✓真实性 ✓正确性 ✗优雅性:{问题} ✗最小化:{问题}`
9. 返回结果：仅输出成功或中断格式

## 验证清单

- [ ] 范围明确且仅审最近变更
- [ ] 真实性/正确性/优雅性/最小化逐项复盘
- [ ] 每个问题有位置与建议
- [ ] 未通过时已修复并继续复盘，未等待用户要求
- [ ] 最终一轮执行 `lint & type-check & test`
- [ ] 返回信息按格式输出

## 示例
为 Button 添加 loading 状态：第1轮 ✗正确性(缺类型) → 修复 + 相关测试；第2轮 ✗最小化(未用 state) → 删除；第3轮 ✓全部 → `✓ 代码复盘完成，满足所有质量要求`
