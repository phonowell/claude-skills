---
name: optimize-docs
description: 优化通用 markdown 文档，遵循行限制和渐进披露原则，use when creating/updating/refactoring/optimizing markdown docs
allowed-tools: Read, Glob, Edit, Bash
---

# 通用文档优化器

## 何时使用

- 目标：优化/重构/创建通用 `.md`
- `SKILL.md` → `optimize-skill`
- `CLAUDE.md` → `optimize-claude-md`
- 其他 `.md` → 本 skill

## 核心意图

在不损坏可执行信息（命令/路径/链接）的前提下，提高文档信息密度并降低维护成本。

## 效率优先

Read/Glob/Edit/Bash > Task · 并行≤3 · 一次性 Edit

## 核心约束

1. 行数：目标 ≤200，`wc -l` 必验
2. 内容边界：禁通用知识/显而易见内容
3. 渐进披露：高频前置，细节后置
4. 压缩优先级：通用知识 > 解释性 > 重复 > 冗余示例 > 格式
5. 可执行性：命令/路径/链接/返回信息必须保真
6. 冲突处理：文档规则冲突时信代码与当前仓库结构
7. 超长策略：>400 行先标记压缩点，再分段或合并 Edit
8. 失败即中断：文件缺失、关键段冲突、验证未过返回 ✗
9. 附件一致性：`example.md`/`references/*` 与主文约束、返回格式保持一致

## 输入/输出契约

- 输入：目标 `.md` 路径、保留段、关键命令/链接、是否允许拆分文档
- 输出：优化后文档 + `wc -l` 结果 + 状态信息
- 成功：`✓ 已优化至 {行数} 行`
- 路由：`✓ 路由至 {skill}`
- 失败：`✗ 中断：{原因}`

## 工作流程

1. 确认范围：单文件且目标明确继续；多文件/大改先走 `plan-implementation`
2. 路由检查：命中 `SKILL.md` 或 `CLAUDE.md` 立即路由并结束
3. 基线分析：Read + `wc -l`；定位通用知识/低 ROI/重复段
4. 建保留清单：命令/路径/链接/返回格式/关键段
5. 一次性优化：按优先级压缩，避免破坏结构和引用
6. 验证：`wc -l`、路由正确、链接有效、示例可验证
7. 返回：仅输出 `✓ 已优化至 {行数} 行` / `✓ 路由至 {skill}` / `✗ 中断：{原因}`

## 优化技术

- 保留：项目特定规则、非显而易见细节、关键配置、检查清单
- 移除：通用知识、过度解释、重复内容、冗长背景
- 压缩：合并同类项、列表替代段落、符号分隔 `·`、精简示例
- 引用：优先行号链接，如 `[package.json:2](package.json#L2)`

## 成功标准

- [ ] ≤200 行（`wc -l` 验证）
- [ ] 无通用知识
- [ ] 信息密度高
- [ ] 关键信息完整
- [ ] 路由判断正确，未误用本 skill
- [ ] 返回信息格式正确
- [ ] 章节顺序/链接引用有效，示例/命令可执行或可验证

## 注意事项与自测

- 不写框架/语言基础；仅保项目上下文
- 大文档分段编辑后复查标题与链接是否失效
- 自测：按成功标准勾选 + `wc -l` + 抽查关键链接/命令
