---
name: optimize-docs
description: 优化通用 markdown 文档，遵循行限制和渐进披露原则，use when creating/updating/refactoring/optimizing markdown docs
allowed-tools: Read, Glob, Edit, Bash
---

# 通用文档优化器

## 何时使用

优化/重构/创建通用 .md 文档（非 SKILL.md 和 CLAUDE.md）

**路由规则**：

- **SKILL.md** → 使用 `optimize-skill` skill
- **CLAUDE.md** → 使用 `optimize-claude-md` skill
- **其他 .md** → 使用本 skill

**效率优先**：直接使用 Read/Glob/Edit/Bash 工具，避免调用 Task 工具

## 核心约束

1. **≤200 行硬限制** · `wc -l` 验证
2. **零通用知识**：不写编程常识/框架基础/语法规则
3. **渐进披露**：高频信息前置 → 详细内容后置
4. **低 ROI 过滤**：移除过度解释/重复内容/显而易见信息
5. **利用上下文**：复用已知信息，节省 tokens
6. **合理压缩**：避免过度压缩导致信息丢失，确保关键内容完整性；过于简短易歧义时需扩写或去歧义
7. **问题修正**：处理错误/矛盾/歧义/遗漏/冗余

## 工作流程

1. **确认需求**：简单（单文件+明确目标）→ `AskUserQuestion` 补足缺口；复杂（多文件/大改动）→ `plan-implementation` 确认范围/优先级

2. **路由检查**：
   - `SKILL.md` → 路由至 `optimize-skill` skill
   - `CLAUDE.md` → 路由至 `optimize-claude-md` skill
   - 其他 .md → 继续

3. **分析**：`wc -l file.md` 检查行数 · Read 评估超限/通用知识/低 ROI

4. **优化**：
   - 优先级：通用知识 > 过度解释 > 冗余 > 示例压缩 > 格式
   - 超长文档（>400 行）：先标记可删/可压缩段，必要时分段 Edit，避免一次性丢失上下文
   - 使用 Edit 工具修改（不调用 Task）；保持章节顺序与链接引用有效
   - 如果原文有返回信息/命令/链接，更新而非删除，确保可执行性

5. **验证**：`wc -l file.md` · 检查通用知识/低 ROI/关键信息完整 · 路由逻辑正确 · 返回信息/示例仍可执行

6. **返回信息**：输出 "✓ 已优化至 {行数} 行" 或 "✓ 路由至 {skill}" 或 "✗ 中断：{原因}"

## 优化技术

### 保留内容

项目特定规则 · 非显而易见细节 · 关键配置 · 代码示例（带行号） · 检查清单

### 移除内容

通用知识 · 过度解释 · 重复内容 · 冗长背景 · 显而易见信息

### 压缩技巧

**批量压缩策略**：超大文档（>500→<300 行）先规划压缩点（通用知识/冗余示例/格式），再合并 Edit（减少迭代次数），避免逐段优化导致 token 膨胀
**合并同类**：`## 命名规范\n组件使用大驼峰。\n## 扩展名\n必须 .tsx` → `组件用大驼峰 + .tsx`
**列表替代段落**：多个独立陈述用 `-`，不用完整句子
**代码引用**：`ID 在 package.json 第 2 行` → `[package.json:2](package.json#L2)`
**符号分隔**：1 行多原则用 `·` 分隔

## 标准结构

Frontmatter → 标题 → 何时使用 → 效率优先 → 核心原则/约束 → 工作流程 → 详细内容（示例/命令）

## 模板与示例

**最小模板**

```
name: my-doc
description: 文档用途，use when ...
# 标题
## 何时使用 ...
## 核心原则/约束 ...
## 工作流程 1. ...
## 示例/命令 ...
## 返回信息 ...
```

**完整范例**：见 `skills/optimize-docs/example.md`

## 成功标准

- [ ] ≤200 行（`wc -l` 验证）
- [ ] 无通用知识
- [ ] 信息密度高
- [ ] 关键信息完整
- [ ] 代码引用准确
- [ ] 路由判断正确，未误用本 skill
- [ ] 返回信息步骤存在且输出符合本 skill 格式
- [ ] 章节顺序/链接引用有效；示例/命令可执行或可验证

## 注意事项与自测

- 不写显而易见的框架/语言基础；示例保留项目特定上下文
- 变更描述或章节时，确保返回信息仍能指导用户（行数/路由/中断原因），示例保持可运行/可验证
- 大文档分段时，保持章节标题与链接引用不失效；编辑后用 `wc -l` 再读关键段确认未截断
- 自测（精简版）：用模板改一小段，对照成功标准勾选，再跑 `wc -l` 并目测示例/链接有效
