---
name: review-dialogue-quality
description: 监控对话质量与成本并输出可执行改进，use when checking conversation quality or reviewing work progress
allowed-tools: Read, Grep, Glob, Bash, Edit
---

# 对话质量复盘

## 何时使用
- 用户要求检查对话质量或 token 效率
- 阶段性收尾时需要复盘执行质量

## 核心意图
用量化证据识别低效模式并给出最小改进补丁。

## 效率优先
优先会话上下文；缺关键数据时最小化读取日志/计划文件。

## 核心约束
1. 每条结论必须有数据依据（实际或估算）
2. 默认只输出建议，不直接改文件
3. 优先定位高成本动作：重复读取/误用工具/低并行
4. 补丁建议必须包含 `文件/位置/动作`
5. 必须核对任务完成度与计划文件更新状态
6. 必须输出 `目标清晰度/约束完整度/可执行性` 三项评分（0-5）

## 输入/输出契约
- 输入：成本统计、工具调用、任务计划记录
- 缺失处理：允许估算，必须标注“估算”
- 输出：固定四行并含依据
  `Token: ...`
  `工具: ...`
  `任务: ...`（含 `目标清晰度/约束完整度/可执行性` 三项评分）
  `补丁: 文件:{path} · 位置:[章节] · 建议:{action} · 状态:✓ 检查完成/✗ 中断:{原因}`

## 工作流程
1. 前置检查：确认是否有成本与日志，缺失则估算
2. 收集分析：token、工具模式、计划更新、验证执行情况
3. 三项评分：`目标清晰度/约束完整度/可执行性`（0-5）并给出依据
4. 证据汇总：token 成本、工具规范、任务完成度
5. 生成补丁：输出最小改动建议，不执行 Edit
6. 固定返回：四行模板 + 状态

## 检查清单
- [ ] 成本来源明确（实际或估算）
- [ ] 已列出工具规范问题
- [ ] 已核对计划与任务完成度
- [ ] 已输出三项评分（0-5）并给出依据
- [ ] 补丁建议含文件/位置/动作
- [ ] 输出严格四行
