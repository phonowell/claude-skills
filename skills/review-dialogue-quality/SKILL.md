---
name: review-dialogue-quality
description: 监控对话质量与成本并输出可执行改进，use when checking conversation quality or reviewing work progress
---

# 对话质量监控

## 何时使用

用户请求质量检查（"总结对话质量"/"检查 token 效率"）或任务结束后主动复盘

## 核心意图

通过可观测数据识别低效模式，降低 token 成本与执行时间，并给出可落地补丁

## 效率优先

仅依赖上下文，禁止使用 Read/Glob/Grep 等工具

## 核心约束

证据驱动 · 非侵入式 · Token 敏感监控 · 补丁可执行 · 输出极简

## 输入/输出契约

- 输入：成本统计或日志；缺失则估算（output ≈ input*5，标注“估算”）
- 输出：固定四行 Token/工具/任务/补丁，均包含数据依据

## 评分维度

### 0. Skill 使用（如有）

触发时机 · 目标达成 · token 效率 · 替代方案
评分：✅ 准确+高效 · ⚠️ 时机/效率问题 · ❌ 误用/浪费
格式：`[Skill名] - 评分 | 触发/效果/建议`

### 1. Token 效率（最高优先级）

数据来源：成本统计或日志
指标：总消耗 · 重复读取（≥2次）· Task 误用 · 超大文件（>200行）· 并行度
阈值：✅ <1500 tokens · ⚠️ 1500-2000 · ❌ >2000
缺失：估算并标注“估算”

### 2. 工具规范

Bash(grep/find) vs Grep/Glob · Write vs Edit · 未并行独立任务 · 未 Read 先于 Edit/Write
评分：✅ 严格遵循 · ⚠️ 1-2 处偏差 · ❌ 频繁违反

### 3. 任务完成

TodoWrite/task_plan.md 更新 · 功能遗漏 · CLAUDE.md 违反 · 检查未执行（tsc/lint）
评分：✅ 完整 · ⚠️ 主要完成或记录缺失 · ❌ 明显遗漏

## 工作流程

1. **前置检查**：确认成本统计或日志；无则标注估算
2. **收集分析**：成本数据（或估算）· 工具调用 · 重复读取 · Skill 使用 · 任务产出/检查
3. **评分输出**：三维度 ✅/⚠️/❌ + 量化理由
4. **补丁建议**：仅文本建议（不执行 Edit），注明文件/位置/建议
5. **返回信息**：输出 "✓ 检查完成" 或 "✗ 中断：{原因}"，自检格式

## 验证清单
- [ ] 费用来源明确（实际或估算已标注）
- [ ] 工具规范问题已列出（重复读/错误工具/未并行）
- [ ] 任务完成度核对（TodoWrite/task_plan.md 更新，检查/验证情况）
- [ ] 补丁建议含文件/位置/建议，未执行 Edit
- [ ] 输出格式正确（评分 + 数据）

## 补丁建议

根据上下文判断归属：`~/.claude/skills/` → 个人 · `.claude/skills/` → 项目
**格式**：`文件: {path} · 位置: [章节] · 建议: 证据驱动改进`

## 证据模板

```
Token: ❌ ~270K ($6.07) | input 230K + output 40.6K | 估算: 否
工具: ✅ 25 轮 3 处并行 | 主要偏差: 无
任务: ✅ 完整 tsc/lint通过 | 记录: task_plan 已更新
补丁: 文件: ~/.claude/skills/foo/SKILL.md · 位置: [核心约束] · 建议: 强制并行读取
```
