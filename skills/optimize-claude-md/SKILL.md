---
name: optimize-claude-md
description: 优化 CLAUDE.md 遵循 100 行限制和渐进披露原则，use when updating/modifying/refactoring/optimizing CLAUDE.md
allowed-tools: Read, Grep, Glob, Edit
---

# CLAUDE.md 优化器

## 何时使用

优化或重构 CLAUDE.md 文件时触发

**效率优先**：Read/Edit > Task · 并行≤3 · 合并探索
**分工**：内容压缩先用 `optimize-docs` skill
**禁止**：🚫 验证性临时文件 · 🚫 重复读取

## 核心约束

1. **≤100 行硬限制** · `wc -l` 验证
2. **渐进披露**：关键约束 → 工作流 → 示例
3. **零通用知识**：不写编程常识、框架基础
4. **低 ROI 过滤**：移除解释性文字、显而易见说明
5. **Token 敏感**：输出 5 倍输入，极致压缩
6. **精简冗余**：机器可读 > 人类可读，符号/缩写/列表
7. **Skill 优先**：有 skill 时指导调用，避免手动步骤
8. **客观诚实**：不主观评价 · 不因用户情绪转移立场 · 不编造事实 · 立刻暴露不确定信息

## 压缩技术

- 符号替代：`·` 分隔 · `→` 流程 · `/` 或
- 缩写词汇：ROI · API · UI · DTO
- 去冗余：删 "请/需要/应该/可以"
- 数字优先：`1/2/3` 替代 "首先/其次/最后"
- 代码引用：`useState` 管理状态（不写 "使用 React useState 钩子"）
- 合并配置：`工具栈：ESLint · Prettier · TS`
- 移除解释：`useMemo` 缓存（不写 "因为性能原因"）
- 利用上下文：假设上下文已知

## 工作流程

**TodoWrite**：≥3步必建

1. **Read + wc -l** 并行获取内容和行数
2. **识别冗余**：通用知识 · 重复表达 · 解释性文字 · 低频场景
3. **应用压缩**：符号替代 · 合并配置 · 代码引用 · 删除助词
4. **确保必备原则**：
   - Skill 使用：调用后**必须等待完成**再执行其他操作
   - 元原则：`精简冗余 · 冲突信代码`
   - 客观诚实：`不主观评价 · 不因用户情绪转移立场 · 不编造事实 · 立刻暴露不确定信息`
   - 类型规范：`≥5处非空断言立即重构类型架构（🚫 eslint-disable 批量压制）`
   - TodoWrite：`≥3 步骤任务必须建 todo · 实时更新状态 · 完成立即标记`
   - 输出约束：`禁预告文字 · 状态用符号 ✓/✗/→ · 一次性批量 Edit · 数据优先 · 直达结论 · 工具间隔零输出 · 错误格式 ✗ {位置}:{类型} · 代码块零注释 · ≥2 条用列表 · 路径缩写（. 项目根 · ~ 主目录）· 禁总结性重复 · 进度 {当前}/{总数} · 提问直入`
5. **Edit 文件**：一次性完成所有修改
6. **验证**：`wc -l` 确认 ≤100 · 核心约束完整
7. **返回信息**：输出 "✓ 已优化至 {行数} 行" 或 "✗ 中断：{原因}"

## 压缩优先级

P0（必保留）：项目特定约束、自定义工具/命令、关键路径
P1（条件保留）：工作流程、代码规范（仅项目特有部分）
P2（优先删除）：示例说明、背景解释、通用最佳实践

## 验证清单

- [ ] 行数 ≤100（`wc -l CLAUDE.md`）
- [ ] 无通用知识（所有内容均为项目特定）
- [ ] 无解释性文字（仅陈述事实和指令）
- [ ] 使用符号压缩
- [ ] 代码片段用反引号
- [ ] 配置项已合并
- [ ] 包含模型切换提示（子任务模型：Task 工具可用 haiku）
- [ ] 包含元原则（精简冗余 · 冲突信代码）
- [ ] 包含 Skill 使用约束
- [ ] 包含客观诚实原则
- [ ] 包含 TodoWrite 使用约束
- [ ] 包含输出约束
