---
name: optimize-claude-md
description: 优化 CLAUDE.md 遵循 100 行限制和渐进披露原则，use when updating/modifying/refactoring/optimizing CLAUDE.md
allowed-tools: Read, Grep, Glob, Edit, Bash
---

# CLAUDE.md 优化器

## 何时使用

优化/重构 CLAUDE.md 文件

**效率优先**：Read/Edit > Task · 并行≤3
**分工**：内容压缩先用 `optimize-docs` skill

## 核心约束

1. **≤100 行** · `wc -l` 验证 · 渐进披露（关键约束 → 工作流 → 示例）
2. **零通用知识**：禁编程常识/框架基础
3. **低 ROI 过滤**：移除解释性文字/显而易见内容
4. **Token 敏感**：输出 5 倍输入，极致压缩（符号 `·→/` · 缩写 · 代码引用 · 合并配置）
5. **Skill 优先**：有 skill 时指导调用，避免手动步骤
6. **客观诚实**：不主观评价 · 不因用户情绪转移立场 · 不编造事实 · 立刻暴露不确定信息
7. **合理压缩**：避免过度压缩导致信息丢失，确保关键内容完整性

## 工作流程

**TodoWrite**：≥3步必建

1. **Read + wc -l** 并行获取内容和行数
2. **识别冗余**：通用知识 · 重复表达 · 解释性文字 · 低频场景
3. **应用压缩**：符号替代 · 合并配置 · 代码引用 · 删除助词
4. **确保必备原则**：
   - Skill 使用：调用后**必须等待完成**再执行其他操作
   - 元原则：`精简冗余 · 冲突信代码`
   - 客观诚实：`不主观评价 · 不因用户情绪转移立场 · 不编造事实 · 立刻暴露不确定信息`
   - 类型规范：`≥5处非空断言立即重构类型架构（🚫 eslint-disable 批量压制）`
   - TodoWrite：`≥3 步骤任务必须建 todo · 实时更新状态 · 完成立即标记`
   - 输出约束：`禁预告文字 · 状态用符号 ✓/✗/→ · 一次性批量 Edit · 数据优先 · 直达结论 · 工具间隔零输出 · 错误格式 ✗ {位置}:{类型} · 代码块零注释 · ≥2 条用列表 · 路径缩写（. 项目根 · ~ 主目录）· 禁总结性重复 · 进度 {当前}/{总数} · 提问直入`
   - Worktree 约束：`强制 git worktree · 禁 switch/checkout · 合并需 squash 单 commit · 合并后清理 worktree 和分支`
5. **Edit 文件**：一次性完成所有修改
6. **验证**：`wc -l` 确认 ≤100 → 执行验证清单逐项检查
7. **返回信息**：输出 "✓ 已优化至 {行数} 行" 或 "✗ 中断：{原因}"

## 压缩优先级

P0：项目特定约束、自定义工具/命令、关键路径
P1：工作流程、代码规范（项目特有）
P2：示例说明、背景解释、通用最佳实践

## 验证清单

- [ ] 行数 ≤100（`wc -l CLAUDE.md`）
- [ ] 无通用知识
- [ ] 无解释性文字
- [ ] 使用符号压缩（·→/）
- [ ] 代码片段用反引号
- [ ] 配置项已合并
- [ ] 包含模型切换提示（Task 工具可用 haiku）
- [ ] 包含元原则（精简冗余 · 冲突信代码）
- [ ] 包含 Skill 使用约束
- [ ] 包含客观诚实原则
- [ ] 包含 TodoWrite 使用约束
- [ ] 包含输出约束
- [ ] 包含 Worktree 约束
