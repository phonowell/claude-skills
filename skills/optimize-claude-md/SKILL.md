---
name: optimize-claude-md
description: 优化 CLAUDE.md 遵循 100 行限制和渐进披露原则，use when updating/modifying/refactoring/optimizing CLAUDE.md
allowed-tools: Read, Grep, Glob, Edit, Bash
---

# CLAUDE.md 优化器

## 何时使用

优化/重构 CLAUDE.md 文件

**效率优先**：Read/Edit > Task · 并行≤3
**规范叠加**：同时遵守 `optimize-docs` 文档规范 + 本 skill 的 CLAUDE.md 特定规范

## 核心约束

1. **≤100 行** · `wc -l` 验证 · 渐进披露（关键约束 → 工作流 → 示例）
2. **零通用知识**：禁编程常识/框架基础
3. **合理压缩**：避免过度压缩导致信息丢失；过于简短易歧义时需扩写或去歧义
4. **低 ROI 过滤**：移除解释性文字/显而易见内容
5. **Token 敏感**：输出 5 倍输入，极致压缩（符号 `·→/` · 缩写 · 代码引用 · 合并配置）
6. **Skill 优先**：有 skill 时指导调用，避免手动步骤
7. **客观诚实**：不主观评价 · 不因用户情绪转移立场 · 不编造事实 · 立刻暴露不确定信息
8. **关键段落保留**：关键约束 / 技术栈 / 核心命令 / 目录结构 / 工作流 / Skill 使用 / 代码规范 / 输出格式 必须保留且内容准确

## 工作流程

**开始前确认**：目标 · 文件路径 · 当前行数 · 保留段列表（关键约束/技术栈/核心命令/目录结构/工作流/Skill 使用/代码规范/输出格式）  
**TodoWrite**：≥3步必建

1. 确认需求：简单（单文件+明确目标）→ `AskUserQuestion`；复杂（多文件/大改动）→ `plan-implementation`
2. 检查 AGENTS.md；不存在则 `ln -s CLAUDE.md AGENTS.md`（CLAUDE.md 为 source）
3. Read + `wc -l` 并行获取内容/行数
4. 列保留段：核对保留段是否缺失/过时，不要删可执行命令/路径/约束条目
5. 识别冗余：通用知识 · 重复表达 · 解释性文字 · 低频场景
6. 应用压缩：符号替代 · 合并配置 · 代码引用 · 删除助词；保持指令可执行、链接/路径有效
7. 保留必备原则（如 CLAUDE.md 所列）：
   - Skill 使用：调用后等待完成再执行
   - 元原则：`精简冗余 · 冲突信代码`
   - 客观诚实：`不主观评价 · 不因用户情绪转移立场 · 不编造事实 · 立刻暴露不确定信息`
   - 类型规范：`≥5处非空断言立即重构类型架构（🚫 eslint-disable 批量压制）`
   - TodoWrite：`≥3 步骤任务必须建 todo · 实时更新状态 · 完成立即标记`
   - 输出约束：`禁预告文字 · 状态用符号 ✓/✗/→ · 一次性批量 Edit · 数据优先 · 直达结论 · 工具间隔零输出 · 错误格式 ✗ {位置}:{类型} · 代码块零注释 · ≥2 条用列表 · 路径缩写（. 项目根 · ~ 主目录）· 禁总结性重复 · 进度 {当前}/{总数} · 提问直入`
8. Edit 文件：一次性完成所有修改
9. 验证：`wc -l` ≤100 → 检查必保留段齐全且内容最新 → 验证清单逐项
10. 返回信息（未验证勿返回）：输出 "✓ 已优化至 {行数} 行" 或 "✗ 中断：{原因}"

## 压缩优先级

P0：项目特定约束、自定义工具/命令、关键路径
P1：工作流程、代码规范（项目特有）
P2：示例说明、背景解释、通用最佳实践

## 验证清单（合并版）

- [ ] 行数 ≤100，符号压缩，零通用/解释性内容
- [ ] 必保留段齐全且最新（关键约束/技术栈/核心命令/目录结构/工作流/Skill 使用/代码规范/输出格式）
- [ ] 必备原则齐全：Skill 使用/元原则/客观诚实/类型规范/TodoWrite/输出约束
- [ ] 返回信息步骤与格式正确
- [ ] 命令/路径/链接可执行或引用有效，配置项已合并

## 示例（骨架）
```
# CLAUDE.md
## 关键约束 ...
## 技术栈 ...
## 核心命令 ...
## 目录结构 ...
## 工作流 ...
## Skill 使用 ...
## 代码规范 ...
## 输出格式 ...
```
