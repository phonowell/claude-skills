---
name: optimize-claude-md
description: 优化 CLAUDE.md 遵循 100 行限制和渐进披露原则，use when updating/modifying/refactoring/optimizing CLAUDE.md
allowed-tools: Read, Grep, Glob, Edit, Bash
---

# CLAUDE.md 优化器

## 何时使用

优化/重构 CLAUDE.md；需要压缩到 ≤100 行并保留关键约束与工作流可执行性。非 CLAUDE.md 路由至 `optimize-docs`/`optimize-skill`。

## 核心意图

在不丢失关键约束/命令/流程的前提下，去冗余、提密度、可检验。

## 效率优先

Read/Edit/Bash > Task · 并行≤3 · 一次性 Edit

**规范叠加**：同时遵守 `optimize-docs` 文档规范 + 本 skill 的 CLAUDE.md 特定规范

## 核心约束

1. **≤100 行** · `wc -l` 验证 · 渐进披露（关键约束 → 工作流 → 示例）
2. **零通用知识**：禁编程常识/框架基础
3. **合理压缩**：避免过度压缩导致信息丢失；过于简短易歧义时需扩写或去歧义
4. **低 ROI 过滤**：移除解释性文字/显而易见内容
5. **Token 敏感**：输出 ≤ 输入\*5；优先 `·→/`/合并配置/代码引用
6. **Skill 优先**：有 skill 时指导调用，避免手动步骤
7. **客观诚实**：不主观评价 · 不因用户情绪转移立场 · 不编造事实 · 立刻暴露不确定信息
8. **关键段落保留**：关键约束/技术栈/核心命令/目录结构/工作流/Skill 使用/代码规范/输出格式必保；若原文存在，保留项目概览/关键规则/测试/安全/环境变量/任务文件(PLANNING.md/TASK.md)

## 输入/输出契约

- 输入：CLAUDE.md 路径、保留段列表、项目关键命令/路径、是否有 AGENTS.md
- 输出：已优化的 CLAUDE.md + 行数；返回 "✓ 已优化至 {行数} 行" 或 "✗ 中断：{原因}"

## 工作流程

1. 确认需求：单文件明确→继续；多文件/大改→用 `plan-implementation`
2. 检查 AGENTS.md：不存在则提示建立 `AGENTS.md -> CLAUDE.md` 软链（先确认）
3. Read + `wc -l` 并行获取内容/行数
4. 列保留段：核对缺失/过时，不删可执行命令/路径/约束
5. 识别冗余：通用知识/重复/冲突/解释性/低频
6. 应用压缩：符号替代/合并配置/代码引用/删助词/去重；保持分区标题与可执行
7. 保留必备原则（以 CLAUDE.md 为准）：
   - Skill 使用：调用后等待完成再执行
   - 元原则：`精简冗余 · 冲突信代码`
   - 客观诚实：`不主观评价 · 不因用户情绪转移立场 · 不编造事实 · 立刻暴露不确定信息`
   - 类型规范：`≥5处非空断言立即重构类型架构（🚫 eslint-disable 批量压制）`
   - 计划管理：`≥3 步任务用 /plans/task_plan_{suffix}.md 并持续更新`
   - 输出约束：`禁预告文字 · 状态用符号 ✓/✗/→ · 一次性批量 Edit · 数据优先 · 直达结论 · 工具间隔零输出 · 错误格式 ✗ {位置}:{类型} · 代码块零注释 · ≥2 条用列表 · 路径缩写（. 项目根 · ~ 主目录）· 禁总结性重复 · 进度 {当前}/{总数} · 提问直入`
8. Edit 文件：一次性完成所有修改
9. 验证：`wc -l` ≤100 → 检查必保留段齐全且最新 → 跑检查清单
10. 返回信息（未验证勿返回）：输出 "✓ 已优化至 {行数} 行" 或 "✗ 中断：{原因}"

## 压缩优先级

P0 项目特定约束/自定义工具/关键路径
P1 工作流程/代码规范（项目特有）
P2 示例/背景/通用最佳实践

## 注意事项 / 错误处理

- 找不到 CLAUDE.md 或内容为空 → 中断并说明
- 关键段落缺失/冲突 → 先确认再改
- 行数仍超限 → 再压缩或拆分引用文档，并在 CLAUDE.md 加链接

## 检查清单

- [ ] 行数 ≤100，符号压缩，零通用/解释性/重复内容
- [ ] 必保留段齐全且最新（关键约束/技术栈/核心命令/目录结构/工作流/Skill 使用/代码规范/输出格式）
- [ ] 必备原则齐全：Skill 使用/元原则/客观诚实/类型规范/计划管理/输出约束
- [ ] 返回信息步骤与格式正确
- [ ] 命令/路径/链接可执行或引用有效，配置项已合并

## 快速参考

```
# CLAUDE.md
## 项目概览 ...
## 关键规则（结构/测试/安全/风格/行为）...
## 技术栈/代码规范 ...
## 目录结构/环境变量 ...
## 核心命令/工作流/任务 ...
## Skill 使用 ...
## 输出格式 ...
```
