# Reference: Manus Context Engineering Principles

## Manus 6 原则

### 1. 文件系统作为外部存储

**问题**：上下文窗口有限 · 塞满内容降低性能增加成本
**方案**：文件系统=无限存储 · 存大量内容于文件 · 上下文仅保留路径 · 需要时查找 · 压缩必须可逆

### 2. 重复读取操控注意力

**问题**：50+ 工具调用后遗忘原始目标（"lost in the middle"）
**方案**：task_plan.md 反复 RE-READ
```
上下文起始：[原始目标 - 远距离，已遗忘]
...大量工具调用...
上下文末尾：[刚读取的 task_plan.md - 获得注意力！]
```
决策前读取计划文件 → 目标出现在注意力窗口

### 3. 保留失败痕迹

> "错误恢复是真正智能体行为的最清晰信号"

**问题**：本能隐藏错误静默重试 · 浪费 token 失去学习
**方案**：计划文件保留失败行为
```markdown
## Errors Encountered
- FileNotFoundError: config.json → 创建默认配置
- API timeout → 指数退避重试成功
```
模型看到失败更新内部理解

### 4. 避免 Few-Shot 过拟合

**问题**：重复 action-observation 模式导致漂移和幻觉
**方案**：引入可控变化 · 变换措辞 · 避免盲目复制模式 · 重复任务时重新校准

### 5. 稳定前缀优化缓存

**问题**：Agent 输入重（100:1 比）· 每 token 成本高
**方案**：静态内容置前 · 仅追加上下文（禁修改历史）· 一致序列化

### 6. 仅追加上下文

**问题**：修改先前消息使 KV-cache 失效
**方案**：禁修改先前消息 · 始终追加新信息

## Agent 循环

Manus 持续循环：分析 → 思考 → 选工具 → 执行 → 观察 → 迭代 → 交付

**文件操作时机**：`write` 新文件/完全重写 · `append` 增量添加 · `edit` 更新特定部分（checkbox/status）· `read` 决策前复查

## 操作化指引

- 仅追加：追加新上下文，禁止改写历史，避免 KV 缓存失效
- 重复读取：决策前 Read task_plan.md，让目标进入窗口；多轮后重复，避免遗忘
- 保留错误：Errors Encountered 记录真实失败及处理，禁止静默重试
- 变换措辞：重复任务时改写提示，防模式固化；避免盲目 few-shot 复制
- 稳定前缀：静态内容前置，补充信息仅追加；保持路径/命令格式一致

## 小清单

- [ ] 决策前 Read 计划（task_plan.md）
- [ ] 失败记录在 Errors，而非删除/隐藏
- [ ] 新增上下文只追加，不改历史
- [ ] 重复任务时改写提示，防过拟合
- [ ] 输出路径/命令格式一致
- [ ] 返回前自检计划/笔记已更新
